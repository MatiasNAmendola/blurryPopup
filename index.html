<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>iOS7 style blurry popup demo.</title>

<script src="jslib/jquery-1.8.2.min.js"></script>
<script src="jslib/jquery-ui-1.8.24.custom.min.js"></script>
<script src="jslib/html2canvas.js"></script>

<style>
html, body { 
	height:100%;
	margin:0;
	font-family:Helvetica;
}
h1 { 
	padding-top:20px;
	margin:0 20px 30px; 
}
h1 small { 
	font-style:italic;
	color:purple 
}
p {
	margin:20px 20px 15px;
}
.share {
	position:fixed;
	bottom:0;
	width:100%;
	background:#F3F3F3;
	height:20px;
	padding:10px;
	z-index:9999;
}

.bg[data-type='0'] {
	width:100%;
	height:1800px;
	background:url(images/bg.png) no-repeat 0 100%;
}
.bg[data-type='1'] {
	width:100%;
	height:1265px;
	background:url(images/1.jpg) no-repeat 0 0;
}
.bg[data-type='2'] {
	width:100%;
	height:929px;
	background:url(images/2.jpg) no-repeat 0 0;
}

.btn_popup {
	padding:0 1.25em;
}

.popup_wrapper {
	overflow: hidden;
	position: absolute;
	z-index: 1000;
	top: 200px;
	left: 200px;
	width: 400px;
	height: 400px;
	-webkit-transform: translate3d(0,0,0);
	transform: translate3d(0,0,0);
	background: #fff;
	cursor: move
}

.popup_bg {
	width: 100%;
	height: 100%;
	background-position: -200px -200px;
	background-repeat: no-repeat;
	-webkit-filter: blur(20px);
	filter: blur(20px);
}

.popup_content {
	position: absolute;
	left: 0;
	top: 0;
	padding:1em;
	width: 100%;
	height: 100%;
	background: rgba(255, 255, 255, 0.25);
}

.dimmed {
	position: fixed;
	z-index: 999;
	left: 0;
	top: 0;
	width: 100%;
	height: 100%;
	background: rgba(0,0,0,0.15)
}
</style>
</head>

<body>
<div class="bg" data-type="0">
	<h1>Blurry popup demo <small>(for WEBKIT only!)</small></h1>
	<p>
		This page uses <a href="http://html2canvas.hertzen.com/" target="_blank">Hertzen's html2canvas</a> script for background rendering<br>
		and <a href="http://jqueryui.com/" target="_blank">jQuery-UI</a> for draggable popup layer.<br>
	</p>
	<a href="javascript:;" class="btn_popup">Show popup</a>
	<a href="javascript:;" class="btn_change_bg">Change BG</a>
	<p>
	<small>Made by <a href="http://github.com/oigil" target="_blank">oigil</a>.</small>
	</p>
</div>

<a href="http://github.com/oigil/blurryPopup"><img style="position: fixed; top: 0; right: 0; border: 0;z-index:9999;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>
<div class="share">
	<a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" >Tweet</a>
	<div class="fb-like" data-href="http://10.13.229.150/blurryPopup/" data-width="450" data-show-faces="true" data-send="true" style="float:right;"></div>
</div>

<script type="text/template" id="popupTemplate">
	<h1>
		Hello!<br>
		You can drag me.
	</h1>
	<a href='javascript:;' class='d_btn type_black btn_close'>Close popup</a>
</script>

<script>
var makePopup = function(){
	html2canvas(document.body, {
		onrendered: function(canvas) {
			var result = canvas.toDataURL("image/jpg").toString();
			
			var popWrap = $(document.createElement("div")).addClass("popup_wrapper"),
				popBg = $(document.createElement("div")).addClass("popup_bg"),
				popContent = $(document.createElement("div")).addClass("popup_content"),
				dimmed = $(document.createElement("div")).addClass("dimmed");
			
			popContent.html($("#popupTemplate").html());
			popContent.find(".btn_close").on("click", function(){
				popWrap.draggable("destroy").unbind().remove();
				dimmed.remove();
			});
			
			popBg.css({
				"backgroundImage": "url(" + result + ")",
			});

			popWrap.append(popBg, popContent);
			$("body").append(dimmed, popWrap);
			
			popWrap.draggable({
				"drag": function(event, ui){
					popBg.css({
						"backgroundPosition": (ui.position.left * -1) + "px " + (ui.position.top * -1) + "px"
					});
				}
			});
		}
	});
};

$(".btn_popup").on("click", makePopup);
$(".btn_change_bg").on("click", function(){
	var current = $(".bg").attr("data-type"),
		next = ( current < 2 ) ? ++current : 0;
	$(".bg").attr("data-type", next);
});

</script>

<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/ko_KR/all.js#xfbml=1&appId=260471694007537";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<script src="https://platform.twitter.com/widgets.js"></script>
</body>
</html>